---
interface Props {
  userId: number;
  error?: string;
}

const { userId, error } = Astro.props as Props;
import Button from "@/components/Button.astro";
import FormInput from "@/components/FormInput.astro";
import { db, certificates as Certificates, eq } from "astro:db";

// Fetch certificates data
const certs = await db
  .select()
  .from(Certificates)
  .where(eq(Certificates.user_id, userId));
---
<section class="space-y-4">
  <h2 class="text-xl font-semibold">Certificates</h2>
  {error && <div class="p-3 bg-red-100 text-red-800 rounded border border-red-300">Error: {error}</div>}
  <form method="post" class="grid grid-cols-1 md:grid-cols-5 gap-4">
    <input type="hidden" name="_action" value="add_certificate" />
    <FormInput
      className="md:col-span-2"
      id="cert_name"
      name="name"
      label="Name"
      placeholder="Name"
    />
    <FormInput id="cert_date" name="date" label="Date" type="date" />
    <FormInput
      id="cert_description"
      name="description"
      label="Issuer / Description"
      placeholder="Issuer / Description"
    />
    <FormInput id="cert_url" name="url" label="URL" placeholder="URL" />
    <div class="md:col-span-5">
      <Button type="submit" variant="primary">Add certificate</Button>
    </div>
  </form>
  <ul class="divide-y rounded border">
    {
      certs.map((c) => (
        <li class="p-4 flex items-center justify-between">
          <div>
            <p class="font-medium">{c.name}</p>
            <p class="text-sm text-fg-subtle">{c.description}</p>
          </div>
          <form method="post">
            <input type="hidden" name="_action" value="delete_certificate" />
            <input type="hidden" name="id" value={String(c.id)} />
            <Button type="submit" variant="danger">
              Delete
            </Button>
          </form>
        </li>
      ))
    }
  </ul>
</section>
