---
import Button from "@/components/Button.astro";

interface LanguageItem {
  id: number;
  language: string;
  abbr: string;
}

interface UserLanguage {
  id: number;
  language_id: number;
}

interface Props {
  languages: LanguageItem[];
  userLanguages: UserLanguage[];
}

const { languages, userLanguages } = Astro.props as Props;
---
<section class="space-y-4">
  <h2 class="text-xl font-semibold">Languages</h2>
  <form method="post" class="flex gap-3 items-end">
    <input type="hidden" name="_action" value="add_language" />
    <div class="flex-1">
      <label for="language_id" class="text-sm">Select language</label>
      <select id="language_id" name="language_id" class="w-full rounded border px-3 py-2">
        {languages.map((l) => (
          <option value={String(l.id)}>{l.language} ({l.abbr})</option>
        ))}
      </select>
    </div>
    <Button type="submit" variant="primary">Add language</Button>
  </form>
  <ul class="flex flex-wrap gap-2">
    {userLanguages.map((ul) => {
      const lang = languages.find((l) => l.id === ul.language_id);
      return (
        <li class="px-3 py-1 rounded border flex items-center gap-2">
          <span>{lang ? `${lang.language} (${lang.abbr})` : `#${ul.language_id}`}</span>
          <form method="post">
            <input type="hidden" name="_action" value="delete_language" />
            <input type="hidden" name="id" value={String(ul.id)} />
            <button class="text-red-600" aria-label={lang ? `Remove language ${lang.language}` : `Remove language #${ul.language_id}`}>Ã—</button>
          </form>
        </li>
      );
    })}
  </ul>
</section>
