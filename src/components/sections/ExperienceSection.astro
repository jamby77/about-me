---
interface ExperienceItem {
  id: number;
  name: string | null;
  title: string | null;
  role: string | null;
  skills: string[] | null;
  responsibilities: string[] | null;
  achievements: string[] | null;
}

interface Props {
  exp: ExperienceItem[];
  availableSkills: string[];
}

const { exp, availableSkills } = Astro.props as Props;
import Button from "@/components/Button.astro";
---
<section class="space-y-4">
  <h2 class="text-xl font-semibold">Experience</h2>
  <form method="post" class="grid grid-cols-1 md:grid-cols-6 gap-4">
    <input type="hidden" name="_action" value="add_experience" />
    <div class="md:col-span-2">
      <label for="exp_company" class="text-sm">Company</label>
      <input
        id="exp_company"
        name="name"
        placeholder="Company"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_title" class="text-sm">Job title</label>
      <input
        id="exp_title"
        name="title"
        placeholder="Title"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_role" class="text-sm">Role</label>
      <input
        id="exp_role"
        name="role"
        placeholder="Role"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_url" class="text-sm">Company URL</label>
      <input
        id="exp_url"
        name="url"
        placeholder="URL"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_start_date" class="text-sm">Start date</label>
      <input
        id="exp_start_date"
        type="date"
        name="start_date"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_end_date" class="text-sm">End date</label>
      <input
        id="exp_end_date"
        type="date"
        name="end_date"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_location" class="text-sm">Location</label>
      <input
        id="exp_location"
        name="location"
        placeholder="Location"
        class="w-full rounded border px-3 py-2"
      />
    </div>
    <div>
      <label for="exp_location_type" class="text-sm">Location type</label>
      <select id="exp_location_type" name="location_type" class="w-full rounded border px-3 py-2">
        <option value="Remote">Remote</option>
        <option value="On Site">On Site</option>
        <option value="Hybrid">Hybrid</option>
      </select>
    </div>
    <div class="md:col-span-3">
      <label for="exp_skills" class="text-sm">Skills (hold Cmd/Ctrl to select multiple)</label>
      <select id="exp_skills" name="skills" multiple class="w-full rounded border px-3 py-2 h-32">
        {availableSkills.map((s) => (
          <option value={s}>{s}</option>
        ))}
      </select>
    </div>
    <div class="md:col-span-3">
      <label for="exp_responsibilities" class="text-sm">Responsibilities (one per line)</label>
      <textarea id="exp_responsibilities" name="responsibilities" rows="4" class="w-full rounded border px-3 py-2" placeholder="Lead feature X\nMentor team members\n..."></textarea>
    </div>
    <div class="md:col-span-3">
      <label for="exp_achievements" class="text-sm">Achievements (one per line)</label>
      <textarea id="exp_achievements" name="achievements" rows="4" class="w-full rounded border px-3 py-2" placeholder="Increased performance by 30%\nLaunched product Y\n..."></textarea>
    </div>
    <div class="md:col-span-6">
      <label for="exp_description" class="text-sm">Description</label>
      <textarea id="exp_description" name="description" rows="3" placeholder="Description" class="w-full rounded border px-3 py-2"></textarea>
    </div>
    <div class="md:col-span-6">
      <Button type="submit" variant="primary">Add experience</Button>
    </div>
  </form>
  <ul class="space-y-4">
    {
      exp.map((x) => (
        <li class="p-4 flex items-center justify-between rounded border">
          <div>
            <p class="font-medium">
              {x.name} â€” {x.title}
            </p>
            <p class="text-sm text-fg-subtle">{x.role}</p>
          </div>
          <form method="post">
            <input type="hidden" name="_action" value="delete_experience" />
            <input type="hidden" name="id" value={String(x.id)} />
            <Button type="submit" variant="danger">
              Delete
            </Button>
          </form>
        </li>
      ))
    }
  </ul>
</section>
